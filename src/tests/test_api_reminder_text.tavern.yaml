test_name: Check user API

includes:
  - !include ../init/common.yaml

stages:
  - name: Get token for user
    request:
      url: "{tavern.env_vars.ENV_API_HOST}/auth/token/"
      verify: false
      method: POST
      json:
        username: "{test_username:s}"
        password: "{test_password:s}"
    response:
      status_code: 200
      save:
        body:
          auth_token: token

  - name: Get course groups
    request:
      url: "{tavern.env_vars.ENV_API_HOST}/planner/coursegroups/"
      verify: false
      method: GET
      headers:
        Authorization: "Token {auth_token:s}"
    response:
      status_code: 200
      save:
        body:
          course_group_id: 0.id


  - name: Get courses
    request:
      url: "{tavern.env_vars.ENV_API_HOST}/planner/coursegroups/{course_group_id}/courses/"
      verify: false
      method: GET
      headers:
        Authorization: "Token {auth_token:s}"
    response:
      status_code: 200
      save:
        body:
          course_id: 0.id

  - name: Get homeworks
    request:
      url: "{tavern.env_vars.ENV_API_HOST}/planner/coursegroups/{course_group_id}/courses/{course_id}/homework/"
      verify: false
      method: GET
      headers:
        Authorization: "Token {auth_token:s}"
    response:
      status_code: 200
      save:
        body:
          homework_id: 5.id

  # TODO: POST to create SMS reminder, but Tavern support for this is currently a bit limited, sleep 12 seconds

  # TODO: assert reminder was sent, verify Twilio has record of SMS


